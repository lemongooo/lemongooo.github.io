---
title: å•†åŸæ¥å£è‡ªåŠ¨åŒ–é¡¹ç›®ä»‹ç»ï¼ˆæ¶æ„+æµ‹è¯•ç”¨ä¾‹+æµ‹è¯•æŠ¥å‘Šï¼‰
description: 'åŸºäºpytestæ¡†æ¶çš„æ¥å£è‡ªåŠ¨åŒ–é¡¹ç›®ä»‹ç».'
publishDate: 2025-10-09
tags:
  - pytest
  - æ¥å£è‡ªåŠ¨åŒ–
language: 'ä¸­æ–‡'
heroImage: { src: './heroimage.png', color: '#ffc4c0ff' }
---
# ç”µå•†å¹³å°æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å®æˆ˜

## ğŸ“‹ é¡¹ç›®ä»‹ç»

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ª**åœ¨çº¿è´­ç‰©å•†åŸç½‘ç«™**çš„æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶,è¦†ç›–ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å•†å“ç®¡ç†ã€ä¸‹å•ã€æ”¯ä»˜ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚é‡‡ç”¨ **Python + Pytest + YAML** æŠ€æœ¯æ ˆ,å®ç°äº†æ•°æ®é©±åŠ¨æµ‹è¯•ã€æ¥å£å‚æ•°å…³è”ã€å¤šç§æ–­è¨€æ¨¡å¼ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **æ•°æ®é©±åŠ¨æµ‹è¯•** - YAMLé…ç½®ä¸ä»£ç åˆ†ç¦»,å®ç°ç”¨ä¾‹è§£è€¦
- âœ… **æ¥å£å‚æ•°å…³è”** - è‡ªåŠ¨æå–å’Œä¼ é€’æ¥å£é—´ä¾èµ–å‚æ•°
- âœ… **å¤šç»´åº¦æ–­è¨€** - æ”¯æŒå“åº”æ–­è¨€ã€çŠ¶æ€ç æ–­è¨€ã€æ•°æ®åº“æ–­è¨€
- âœ… **POMè®¾è®¡æ¨¡å¼** - åˆ†ç¦»ç”¨ä¾‹å±‚ä¸é©±åŠ¨å±‚,æå‡å¯ç»´æŠ¤æ€§
- âœ… **å…¨æµç¨‹æµ‹è¯•** - æ”¯æŒç”¨æˆ·ç®¡ç†ã€å•†å“ä¸‹å•å®Œæ•´ä¸šåŠ¡åœºæ™¯
- âœ… **å¯è§†åŒ–æŠ¥å‘Š** - é›†æˆ Allure ç”Ÿæˆè¯¦ç»†æµ‹è¯•æŠ¥å‘Š

### æŠ€æœ¯æ ˆ

```text
æµ‹è¯•æ¡†æ¶: Pytest
è¯·æ±‚åº“: Requests
æ•°æ®é©±åŠ¨: YAML + Parametrize
æ–­è¨€å¼•æ“: è‡ªå®šä¹‰å¤šæ¨¡å¼æ–­è¨€
æ•°æ®åº“: SQLAlchemy + PyMySQL
æŠ¥å‘Šå·¥å…·: Allure
æŒç»­é›†æˆ: Jenkins + Linux
æ•°æ®æå–: JSONPath + æ­£åˆ™è¡¨è¾¾å¼
```

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„

```plaintext
automaticAPI/
â”œâ”€â”€ base/                       # åŸºç¡€å°è£…å±‚
â”‚   â”œâ”€â”€ apiutil.py             # å•æ¥å£ç”¨ä¾‹å¤„ç†(é©±åŠ¨å±‚)
â”‚   â””â”€â”€ generateId.py          # æŠ¥å‘ŠIDç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ common/                     # å…¬å…±æ–¹æ³•å±‚
â”‚   â”œâ”€â”€ sendrequest.py         # HTTPè¯·æ±‚ç»Ÿä¸€å°è£…
â”‚   â”œâ”€â”€ assertions.py          # æ–­è¨€å¼•æ“
â”‚   â”œâ”€â”€ debugtalk.py           # åŠ¨æ€å‚æ•°è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ readyaml.py            # YAMLæ•°æ®è¯»å–
â”‚   â””â”€â”€ recordlog.py           # æ—¥å¿—è®°å½•
â”‚
â”œâ”€â”€ conf/                       # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config.ini             # ç¯å¢ƒé…ç½®(host/æ•°æ®åº“)
â”‚   â””â”€â”€ operationConfig.py     # é…ç½®è¯»å–å·¥å…·
â”‚
â”œâ”€â”€ data/                       # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ extract.yaml           # æ¥å£å‚æ•°æå–å­˜å‚¨
â”‚
â”œâ”€â”€ testcase/                   # æµ‹è¯•ç”¨ä¾‹å±‚
â”‚   â”œâ”€â”€ Single interface/      # å•æ¥å£æµ‹è¯•ç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ addUser.yaml       # æ–°å¢ç”¨æˆ·
â”‚   â”‚   â”œâ”€â”€ updateUser.yaml    # ä¿®æ”¹ç”¨æˆ·
â”‚   â”‚   â”œâ”€â”€ deleteUser.yaml    # åˆ é™¤ç”¨æˆ·
â”‚   â”‚   â””â”€â”€ queryUser.yaml     # æŸ¥è¯¢ç”¨æˆ·
â”‚   â”‚
â”‚   â””â”€â”€ ProductManager/        # å•†å“ç®¡ç†ç”¨ä¾‹
â”‚       â”œâ”€â”€ getProductList.yaml # å•†å“åˆ—è¡¨
â”‚       â”œâ”€â”€ commitOrder.yaml    # æäº¤è®¢å•
â”‚       â””â”€â”€ orderPay.yaml       # è®¢å•æ”¯ä»˜
â”‚
â”œâ”€â”€ logs/                       # æµ‹è¯•æ—¥å¿—
â”œâ”€â”€ report/                     # æµ‹è¯•æŠ¥å‘Š
â”‚   â”œâ”€â”€ temp/                  # AllureåŸå§‹æ•°æ®
â”‚   â””â”€â”€ html/                  # HTMLæŠ¥å‘Š
â”‚
â”œâ”€â”€ test_debug_api.py          # ç”¨æˆ·ç®¡ç†æµ‹è¯•å…¥å£
â”œâ”€â”€ test_productList.py        # å•†å“ç®¡ç†æµ‹è¯•å…¥å£
â”œâ”€â”€ conftest.py                # Pytestå…¨å±€é…ç½®
â”œâ”€â”€ pytest.ini                 # Pytesté…ç½®æ–‡ä»¶
â””â”€â”€ requirements.txt           # é¡¹ç›®ä¾èµ–
```

### POMæ¶æ„è®¾è®¡

**æ¶æ„æµç¨‹:**

```
æµ‹è¯•ç”¨ä¾‹å±‚ (test_*.py)
    â†“ è°ƒç”¨
é©±åŠ¨å±‚ (RequestBase)
    â†“ è¯»å–
æ•°æ®å±‚ (YAMLé…ç½®)
    â†“ åŠ¨æ€æ›¿æ¢
è¾…åŠ©å‡½æ•° (DebugTalk)
    â†“ å‘é€è¯·æ±‚
è¯·æ±‚å°è£… (SendRequest)
    â†“ HTTPè¯·æ±‚
æœåŠ¡å™¨æ¥å£
    â†“ å“åº”å¤„ç†
ç»“æœå¤„ç†
    â”œâ”€ å‚æ•°æå– â†’ extract.yaml
    â””â”€ æ–­è¨€éªŒè¯ â†’ Assertions
           â†“
    Allureæµ‹è¯•æŠ¥å‘Š
```

**ä¸‰å±‚æ¶æ„è¯´æ˜:**

| å±‚çº§ | æ–‡ä»¶/ç±» | èŒè´£ | ä¼˜åŠ¿ |
|-----|---------|------|------|
| **ç”¨ä¾‹å±‚** | test_debug_api.py<br/>test_productList.py | å®šä¹‰æµ‹è¯•åœºæ™¯å’Œæ‰§è¡Œæµç¨‹ | ä¸“æ³¨ä¸šåŠ¡é€»è¾‘,æ˜“äºç»´æŠ¤ |
| **é©±åŠ¨å±‚** | apiutil.py<br/>RequestBaseç±» | å°è£…è¯·æ±‚ã€æ–­è¨€ã€å‚æ•°æ›¿æ¢ | ç»Ÿä¸€å¤„ç†,ä»£ç å¤ç”¨ |
| **æ•°æ®å±‚** | addUser.yaml<br/>commitOrder.yaml | å­˜å‚¨æ¥å£é…ç½®å’Œæµ‹è¯•æ•°æ® | ç”¨ä¾‹ä¸æ•°æ®åˆ†ç¦»,æ˜“æ‰©å±• |

---

## âš™ï¸ ç¯å¢ƒé…ç½®

### 1. ä¾èµ–å®‰è£…

```bash
pip install -r requirements.txt
```

### 2. æ ¸å¿ƒä¾èµ–æ¸…å•

æ ¸å¿ƒä¾èµ–åŒ…:

- **pytest** - æµ‹è¯•æ¡†æ¶
- **allure-pytest** - æŠ¥å‘Šç”Ÿæˆ
- **requests** - HTTPè¯·æ±‚
- **PyYAML** - YAMLè§£æ
- **jsonpath** - JSONæå–
- **PyMySQL** - MySQLæ“ä½œ
- **SQLAlchemy** - ORMæ¡†æ¶
- **faker** - æµ‹è¯•æ•°æ®ç”Ÿæˆ

### 3. Pytesté…ç½®

```ini
[pytest]
python_files = test_*.py
python_classes = Test*
python_functions = test
```

### 4. ç¯å¢ƒé…ç½®

```ini
[api_envi]
host = http://127.0.0.1:8787

[MYSQL]
host = localhost
port = 3306
username = root
password = 12345
database = testdb
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. YAMLæ•°æ®é©±åŠ¨

#### ç”¨ä¾‹æ¨¡æ¿ç»“æ„

```yaml
- baseInfo:                           # æ¥å£åŸºç¡€ä¿¡æ¯
    api_name: æ¥å£åç§°
    url: /api/path
    method: POST                      # è¯·æ±‚æ–¹æ³•
    header:                           # è¯·æ±‚å¤´
      Content-Type: application/json
  
  testCase:                           # æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨
    - case_name: ç”¨ä¾‹åç§°
      json:                           # è¯·æ±‚ä½“(JSONæ ¼å¼)
        param1: value1
        param2: ${get_extract_data(token)}  # åŠ¨æ€å‚æ•°
      
      validation:                     # æ–­è¨€é…ç½®
        - contains: {'status_code': 200}
        - eq: {'error_code': '0000'}
      
      extract:                        # å‚æ•°æå–
        userId: $.data.userId
```

#### å®æˆ˜æ¡ˆä¾‹1: ç”¨æˆ·ç®¡ç†

```yaml
- baseInfo:
    api_name: æ–°å¢ç”¨æˆ·
    url: /dar/user/addUser
    method: POST
    header:
      Content-Type: application/x-www-form-urlencoded;charset=UTF-8
  
  testCase:
    - case_name: æ­£å¸¸æ–°å¢ç”¨æˆ·
      data:
        username: testadduser
        password: tset6789890
        role_id: 123456789
        dates: '2023-12-31'
        phone: 13800000000
        token: ${get_extract_data(token)}    # ä¾èµ–ç™»å½•æ¥å£è¿”å›çš„token
      validation:
        - contains: {'status_code': 200}
        - contains: {'msg': 'æ–°å¢æˆåŠŸ'}
    
    - case_name: æ— æ•ˆæ–°å¢Â·ç¼ºå°‘token
      data:
        username: testadduser
        password: tset6789890
        role_id: 123456789
        token:                                # tokenä¸ºç©º
      validation:
        - contains: {'msg': 'æ–°å¢å¤±è´¥'}
    
    - case_name: æ— æ•ˆæ–°å¢Â·ç¼ºå°‘å¿…å¡«å‚æ•°
      data:
        password: tset6789890
        role_id: 123456789
        # ç¼ºå°‘usernameå‚æ•°
      validation:
        - contains: {'msg': 'æ–°å¢å¤±è´¥'}
```

#### å®æˆ˜æ¡ˆä¾‹2: ç”µå•†ä¸‹å•æµç¨‹

```yaml
- baseInfo:
    api_name: æäº¤è®¢å•
    url: /coupApply/cms/placeAnOrder
    method: post
    header:
      Content-Type: application/json;charset=UTF-8
  
  testCase:
    - case_name: æäº¤è®¢å•
      json:
        goods_id: ${get_extract_data(goodsId,0)}      # ä»å•†å“åˆ—è¡¨æå–
        number: 2
        propertyChildIds: '2:9'
        price: '128'
        consignee_info: 
          name: "å¼ ä¸‰"
          phone: 13800000000
          address: "åŒ—äº¬å¸‚æµ·æ·€åŒºè¥¿ä¸‰ç¯åŒ—è·¯74å·"
      
      validation:
        - eq: {'message': 'æäº¤è®¢å•æˆåŠŸ'}
        - eq: {'error_code': '0000'}
      
      extract:                                        # æå–è®¢å•å·ä¾›æ”¯ä»˜æ¥å£ä½¿ç”¨
        orderNumber: $.orderNumber
        userId: $.userId
```

```yaml
- baseInfo:
    api_name: è®¢å•æ”¯ä»˜
    url: /coupApply/cms/orderPay
    method: post
  
  testCase:
    - case_name: è®¢å•æ”¯ä»˜
      json:
        orderNumber: ${get_extract_data(orderNumber)}  # ä¾èµ–æäº¤è®¢å•è¿”å›çš„è®¢å•å·
        userId: ${get_extract_data(userId)}
        timeStamp: ${timestamp()}                      # åŠ¨æ€æ—¶é—´æˆ³
      
      validation:
        - contains: {'message': 'è®¢å•æ”¯ä»˜æˆåŠŸ'}
        - contains: {'error_code': '0000'}
```

---

### 2. æ¥å£å‚æ•°å…³è”

#### å‚æ•°æå–æœºåˆ¶

**æ”¯æŒä¸¤ç§æå–æ–¹å¼:**

```yaml
# æ–¹å¼1: JSONPathæå–(æ¨è)
extract:
  token: $.data.token                    # æå–å•ä¸ªå€¼
  userId: $.data.user.id

# æ–¹å¼2: æ­£åˆ™è¡¨è¾¾å¼æå–
extract:
  token: '"token": "(.*?)"'              # æ­£åˆ™åŒ¹é…

# æ–¹å¼3: åˆ—è¡¨æ•°æ®æå–
extract_list:
  goodsIds: $.goodsList[*].goodsId       # æå–æ‰€æœ‰å•†å“ID
```

#### å‚æ•°ä½¿ç”¨

```yaml
# åœ¨åç»­æ¥å£ä¸­ä½¿ç”¨æå–çš„å‚æ•°
json:
  token: ${get_extract_data(token)}           # è·å–å•ä¸ªå€¼
  goods_id: ${get_extract_data(goodsIds,0)}   # è·å–åˆ—è¡¨ç¬¬0ä¸ªå…ƒç´ 
```

#### æ ¸å¿ƒä»£ç å®ç°

```python
class RequestBase:
    """è¯·æ±‚åŸºç¡€ç±» - é©±åŠ¨å±‚æ ¸å¿ƒ"""
    
    def extract_data(self, testcase_extract, response):
        """
        æå–æ¥å£å“åº”å‚æ•°å¹¶å­˜å‚¨åˆ°extract.yaml
        
        Args:
            testcase_extract: YAMLä¸­çš„extracté…ç½®
            response: æ¥å£å“åº”æ–‡æœ¬
        """
        for key, value in testcase_extract.items():
            # JSONPathæå–
            if value.startswith('$.'):
                ext_data = jsonpath.jsonpath(
                    json.loads(response), value
                )
                if ext_data:
                    # å­˜å‚¨åˆ°extract.yaml
                    self.write_extract_yaml({key: ext_data[0]})
                    logs.info(f"å‚æ•°æå–æˆåŠŸ: {key} = {ext_data[0]}")
            
            # æ­£åˆ™è¡¨è¾¾å¼æå–
            else:
                ext_list = re.search(value, response)
                if ext_list:
                    self.write_extract_yaml({key: ext_list.group(1)})
    
    def replace_data(self, data):
        """
        åŠ¨æ€æ›¿æ¢YAMLä¸­çš„${å‡½æ•°å(å‚æ•°)}æ ¼å¼
        
        ç¤ºä¾‹:
            ${get_extract_data(token)} â†’ ä»extract.yamlè¯»å–tokenå€¼
            ${timestamp()} â†’ ç”Ÿæˆå½“å‰æ—¶é—´æˆ³
            ${random_phone()} â†’ ç”Ÿæˆéšæœºæ‰‹æœºå·
        """
        pattern = r'\$\{(.+?)\}'
        
        while re.search(pattern, str(data)):
            res_value = re.search(pattern, str(data))
            func_name = res_value.group(1)
            
            # æ‰§è¡Œdebugtalk.pyä¸­çš„å‡½æ•°
            value = eval(func_name)
            
            # æ›¿æ¢åŸå§‹æ•°æ®
            data = re.sub(pattern, str(value), str(data), count=1)
        
        return data
```

---

### 3. å¤šæ¨¡å¼æ–­è¨€å¼•æ“

#### æ”¯æŒçš„æ–­è¨€ç±»å‹

| æ–­è¨€æ¨¡å¼ | YAMLé…ç½®ç¤ºä¾‹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|-------------|------|---------|
| **contains** | `contains: {'msg': 'æˆåŠŸ'}` | æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å«æŸå€¼ | é€šç”¨æ–­è¨€ â­â­â­â­â­ |
| **eq** | `eq: {'error_code': '0000'}` | ç²¾ç¡®åŒ¹é…å­—æ®µå€¼ | çŠ¶æ€ç /é”™è¯¯ç éªŒè¯ â­â­â­â­ |
| **ne** | `ne: {'status': 'failed'}` | éªŒè¯å­—æ®µä¸ç­‰äºæŸå€¼ | åå‘éªŒè¯ â­â­â­ |
| **db** | `db: SELECT * FROM users WHERE id=1` | æ•°æ®åº“æ•°æ®éªŒè¯ | æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ â­â­â­â­ |

#### æ–­è¨€å®ç°

```python
class Assertions:
    """æ–­è¨€å¼•æ“"""
    
    def contains_assert(self, expected, response, status_code):
        """
        åŒ…å«æ–­è¨€ - æ£€æŸ¥å“åº”ä¸­æ˜¯å¦åŒ…å«æœŸæœ›å€¼
        
        Args:
            expected: {'msg': 'æˆåŠŸ', 'status_code': 200}
            response: æ¥å£å“åº”JSON
            status_code: HTTPçŠ¶æ€ç 
        """
        flag = 0  # å¤±è´¥æ ‡è®°
        
        for key, value in expected.items():
            if key == "status_code":
                # æ–­è¨€çŠ¶æ€ç 
                if value != status_code:
                    flag += 1
                    logs.error(f"çŠ¶æ€ç æ–­è¨€å¤±è´¥: {status_code} != {value}")
            else:
                # æ–­è¨€å“åº”å­—æ®µ
                resp_list = jsonpath.jsonpath(response, f"$..{key}")
                if value not in resp_list:
                    flag += 1
                    logs.error(f"åŒ…å«æ–­è¨€å¤±è´¥: {value} ä¸åœ¨ {resp_list}")
        
        return flag
    
    def equal_assert(self, expected, actual, status_code=None):
        """
        ç›¸ç­‰æ–­è¨€ - ç²¾ç¡®åŒ¹é…å­—æ®µå€¼
        
        ç¤ºä¾‹:
            expected: {'error_code': '0000'}
            actual: {'error_code': '0000', 'msg': 'æˆåŠŸ'}
        """
        flag = 0
        common_key = list(expected.keys() & actual.keys())[0]
        
        if actual[common_key] == expected[common_key]:
            logs.info(f"ç›¸ç­‰æ–­è¨€æˆåŠŸ: {actual[common_key]} == {expected[common_key]}")
        else:
            flag += 1
            logs.error(f"ç›¸ç­‰æ–­è¨€å¤±è´¥: {actual[common_key]} != {expected[common_key]}")
        
        return flag
    
    def assert_mysql_data(self, sql):
        """
        æ•°æ®åº“æ–­è¨€ - éªŒè¯æ•°æ®åº“ä¸­çš„æ•°æ®
        
        Args:
            sql: SELECT * FROM users WHERE username='testuser'
        """
        conn = ConnectMysql()
        db_value = conn.query_all(sql)
        
        if db_value is not None:
            logs.info(f"æ•°æ®åº“æ–­è¨€æˆåŠŸ: æŸ¥è¯¢åˆ° {len(db_value)} æ¡æ•°æ®")
            return 0
        else:
            logs.error("æ•°æ®åº“æ–­è¨€å¤±è´¥: æœªæŸ¥è¯¢åˆ°æ•°æ®")
            return 1
```

#### æ–­è¨€æ‰§è¡Œæµç¨‹

**æµç¨‹è¯´æ˜:**

```
æ¥å£å“åº”
  â†“
è§£æ validation é…ç½®
  â†“
éå†æ–­è¨€åˆ—è¡¨
  â†“
åˆ¤æ–­æ–­è¨€ç±»å‹
  â”œâ”€ contains â†’ åŒ…å«æ–­è¨€
  â”œâ”€ eq â†’ ç›¸ç­‰æ–­è¨€
  â”œâ”€ ne â†’ ä¸ç›¸ç­‰æ–­è¨€
  â””â”€ db â†’ æ•°æ®åº“æ–­è¨€
       â†“
ç´¯è®¡å¤±è´¥æ ‡è®° flag
  â†“
flag == 0 ?
  â”œâ”€ æ˜¯ â†’ âœ… æ–­è¨€æˆåŠŸ
  â””â”€ å¦ â†’ âŒ æ–­è¨€å¤±è´¥(æŠ›å‡ºå¼‚å¸¸)
```

---

### 4. åŠ¨æ€å‚æ•°å¤„ç†

#### è¾…åŠ©å‡½æ•°åº“

```python
import time
import random
from faker import Faker

fake = Faker('zh_CN')

# === å‚æ•°æå–ç›¸å…³ ===
def get_extract_data(key, index=None):
    """
    ä»extract.yamlè¯»å–æå–çš„å‚æ•°
    
    Args:
        key: å‚æ•°å
        index: åˆ—è¡¨ç´¢å¼•(å¯é€‰)
            None - è¿”å›å•ä¸ªå€¼
            0,1,2... - è¿”å›åˆ—è¡¨æŒ‡å®šä½ç½®çš„å€¼
            -1 - è¿”å›æ‰€æœ‰å€¼çš„å­—ç¬¦ä¸²(é€—å·åˆ†éš”)
            -2 - è¿”å›æ‰€æœ‰å€¼çš„åˆ—è¡¨
    
    ç¤ºä¾‹:
        goodsIds = ['123', '456', '789']
        get_extract_data('goodsIds', 0)  â†’ '123'
        get_extract_data('goodsIds', -1) â†’ '123,456,789'
        get_extract_data('goodsIds', -2) â†’ ['123','456','789']
    """
    data = read_extract_yaml(key)
    
    if index is None:
        return data
    elif index == -1:
        return ','.join(data)
    elif index == -2:
        return data
    else:
        return data[index]

# === æ—¶é—´ç›¸å…³ ===
def timestamp():
    """ç”Ÿæˆ13ä½æ—¶é—´æˆ³(æ¯«ç§’)"""
    return int(time.time() * 1000)

def today_zero_stamp():
    """è·å–ä»Šå¤©é›¶ç‚¹æ—¶é—´æˆ³"""
    today = time.strftime('%Y-%m-%d', time.localtime())
    return int(time.mktime(time.strptime(today, '%Y-%m-%d')))

def get_current_time():
    """è·å–å½“å‰æ—¶é—´å­—ç¬¦ä¸²: 2025-10-12 15:30:00"""
    return time.strftime('%Y-%m-%d %H:%M:%S', time.localtime())

# === éšæœºæ•°æ®ç”Ÿæˆ ===
def random_phone():
    """ç”Ÿæˆéšæœºæ‰‹æœºå·"""
    return fake.phone_number()

def random_name():
    """ç”Ÿæˆéšæœºå§“å"""
    return fake.name()

def random_address():
    """ç”Ÿæˆéšæœºåœ°å€"""
    return fake.address()

def random_email():
    """ç”Ÿæˆéšæœºé‚®ç®±"""
    return fake.email()

def random_id_card():
    """ç”Ÿæˆéšæœºèº«ä»½è¯å·"""
    return fake.ssn()

# === å­—ç¬¦ä¸²å¤„ç† ===
def generate_random_str(length=8):
    """ç”ŸæˆæŒ‡å®šé•¿åº¦çš„éšæœºå­—ç¬¦ä¸²"""
    chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'
    return ''.join(random.choice(chars) for _ in range(length))
```

#### ä½¿ç”¨ç¤ºä¾‹

```yaml
testCase:
  - case_name: æ³¨å†Œæ–°ç”¨æˆ·
    json:
      username: ${random_name()}              # éšæœºå§“å
      phone: ${random_phone()}                # éšæœºæ‰‹æœºå·
      email: ${random_email()}                # éšæœºé‚®ç®±
      register_time: ${get_current_time()}    # å½“å‰æ—¶é—´
      timestamp: ${timestamp()}               # æ—¶é—´æˆ³
```

---

### 5. è¯·æ±‚ç»Ÿä¸€å°è£…

```python
import requests
import allure
from common.recordlog import logs

class SendRequest:
    """HTTPè¯·æ±‚ç»Ÿä¸€å°è£…"""
    
    def send_request(self, **kwargs):
        """å‘é€HTTPè¯·æ±‚"""
        session = requests.session()
        
        try:
            # å‘é€è¯·æ±‚
            result = session.request(**kwargs)
            
            # è®°å½•æ—¥å¿—
            logs.info(f"å“åº”çŠ¶æ€ç : {result.status_code}")
            logs.info(f"å“åº”å†…å®¹: {result.text}")
            
            return result
            
        except requests.exceptions.ConnectionError:
            logs.error("è¿æ¥å¼‚å¸¸")
            pytest.fail("æ¥å£è¯·æ±‚å¤±è´¥: è¿æ¥å¼‚å¸¸")
        except requests.exceptions.Timeout:
            logs.error("è¯·æ±‚è¶…æ—¶")
            pytest.fail("æ¥å£è¯·æ±‚å¤±è´¥: è¯·æ±‚è¶…æ—¶")
    
    def run_main(self, name, url, case_name, header, method, **kwargs):
        """
        è¯·æ±‚ä¸»å…¥å£
        
        Args:
            name: æ¥å£åç§°
            url: æ¥å£åœ°å€
            case_name: æµ‹è¯•ç”¨ä¾‹åç§°
            header: è¯·æ±‚å¤´
            method: è¯·æ±‚æ–¹æ³•(GET/POST)
            **kwargs: è¯·æ±‚å‚æ•°(params/data/json)
        """
        # æ—¥å¿—è®°å½•
        logs.info(f'=' * 100)
        logs.info(f'æ¥å£åç§°: {name}')
        logs.info(f'æµ‹è¯•ç”¨ä¾‹: {case_name}')
        logs.info(f'è¯·æ±‚åœ°å€: {url}')
        logs.info(f'è¯·æ±‚æ–¹å¼: {method}')
        
        # AllureæŠ¥å‘Šé™„ä»¶
        if "data" in kwargs or "json" in kwargs:
            allure.attach(
                json.dumps(kwargs, ensure_ascii=False),
                'è¯·æ±‚å‚æ•°',
                allure.attachment_type.TEXT
            )
        
        # å‘é€è¯·æ±‚
        response = self.send_request(
            method=method,
            url=url,
            headers=header,
            timeout=30,
            verify=False,
            **kwargs
        )
        
        return response
```

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹å®ç°

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—

```python
import allure
import pytest
from common.readyaml import get_testcase_yaml
from base.apiutil import RequestBase
from base.generateId import m_id, c_id

@allure.feature(next(m_id) + 'ç”¨æˆ·ç®¡ç†æ¨¡å—')
class TestUserManager:
    
    @allure.story(next(c_id) + "æ–°å¢ç”¨æˆ·")
    @pytest.mark.run(order=1)
    @pytest.mark.parametrize('base_info,testcase', 
        get_testcase_yaml("./testcase/Single interface/addUser.yaml"))
    def test_add_user(self, base_info, testcase):
        """æµ‹è¯•æ–°å¢ç”¨æˆ·æ¥å£"""
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
    
    @allure.story(next(c_id) + "ä¿®æ”¹ç”¨æˆ·")
    @pytest.mark.run(order=2)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml("./testcase/Single interface/updateUser.yaml"))
    def test_update_user(self, base_info, testcase):
        """æµ‹è¯•ä¿®æ”¹ç”¨æˆ·æ¥å£"""
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
    
    @allure.story(next(c_id) + "åˆ é™¤ç”¨æˆ·")
    @pytest.mark.run(order=3)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml("./testcase/Single interface/deleteUser.yaml"))
    def test_delete_user(self, base_info, testcase):
        """æµ‹è¯•åˆ é™¤ç”¨æˆ·æ¥å£"""
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
    
    @allure.story(next(c_id) + "æŸ¥è¯¢ç”¨æˆ·")
    @pytest.mark.run(order=4)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml("./testcase/Single interface/queryUser.yaml"))
    def test_query_user(self, base_info, testcase):
        """æµ‹è¯•æŸ¥è¯¢ç”¨æˆ·æ¥å£"""
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
```

### 2. å•†å“ä¸‹å•å…¨æµç¨‹

```python
import allure
import pytest
from base.apiutil import RequestBase
from common.readyaml import get_testcase_yaml
from base.generateId import m_id, c_id

@allure.feature(next(m_id) + 'å•†å“ç®¡ç†æ¨¡å—')
class TestProductFlow:
    
    @allure.story(next(c_id) + "è·å–å•†å“åˆ—è¡¨")
    @pytest.mark.run(order=1)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml('./testcase/ProductManager/getProductList.yaml'))
    def test_get_product_list(self, base_info, testcase):
        """
        æµ‹è¯•è·å–å•†å“åˆ—è¡¨
        - æå–å•†å“IDä¾›åç»­æ¥å£ä½¿ç”¨
        """
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
    
    @allure.story(next(c_id) + "æäº¤è®¢å•")
    @pytest.mark.run(order=2)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml('./testcase/ProductManager/commitOrder.yaml'))
    def test_commit_order(self, base_info, testcase):
        """
        æµ‹è¯•æäº¤è®¢å•
        - ä½¿ç”¨å•†å“åˆ—è¡¨æ¥å£è¿”å›çš„å•†å“ID
        - æå–è®¢å•å·ä¾›æ”¯ä»˜æ¥å£ä½¿ç”¨
        """
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
    
    @allure.story(next(c_id) + "è®¢å•æ”¯ä»˜")
    @pytest.mark.run(order=3)
    @pytest.mark.parametrize('base_info,testcase',
        get_testcase_yaml('./testcase/ProductManager/orderPay.yaml'))
    def test_order_pay(self, base_info, testcase):
        """
        æµ‹è¯•è®¢å•æ”¯ä»˜
        - ä½¿ç”¨æäº¤è®¢å•è¿”å›çš„è®¢å•å·
        - éªŒè¯æ”¯ä»˜ç»“æœ
        """
        allure.dynamic.title(testcase['case_name'])
        RequestBase().specification_yaml(base_info, testcase)
```

**ä¸šåŠ¡æµç¨‹è¯´æ˜:**
```
å•†å“åˆ—è¡¨ â†’ æäº¤è®¢å• â†’ è®¢å•æ”¯ä»˜
   â†“          â†“          â†“
æå–å•†å“ID  æå–è®¢å•å·   éªŒè¯æ”¯ä»˜æˆåŠŸ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       å‚æ•°è‡ªåŠ¨ä¼ é€’
```

---

## ğŸ“Š æµ‹è¯•æ‰§è¡Œä¸æŠ¥å‘Š

### 1. æ‰§è¡Œæµ‹è¯•

```bash
# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
pytest testcase/ -vs

# ç”ŸæˆAllureæŠ¥å‘Š
pytest testcase/ -vs --alluredir ./report/temp

# æŸ¥çœ‹AllureæŠ¥å‘Š
allure serve ./report/temp
```

### 2. AllureæŠ¥å‘Šå±•ç¤º

#### æŠ¥å‘Šæ¦‚è§ˆ
```
âœ… é€šè¿‡: 45
âŒ å¤±è´¥: 3
âš ï¸  è·³è¿‡: 2
æ€»è®¡: 50
é€šè¿‡ç‡: 90%
æ‰§è¡Œæ—¶é•¿: 2.3åˆ†é’Ÿ
```

#### æŠ¥å‘Šç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æµ‹è¯•å¥—ä»¶åˆ†ç±»** | æŒ‰æ¨¡å—å±•ç¤ºç”¨ä¾‹(ç”¨æˆ·ç®¡ç†/å•†å“ç®¡ç†) |
| **ç”¨ä¾‹è¯¦æƒ…** | æ˜¾ç¤ºè¯·æ±‚å‚æ•°ã€å“åº”ç»“æœã€æ–­è¨€ä¿¡æ¯ |
| **å¤±è´¥åˆ†æ** | è¯¦ç»†çš„å¤±è´¥åŸå› å’Œå †æ ˆä¿¡æ¯ |
| **è¶‹åŠ¿å›¾è¡¨** | å¤šæ¬¡æ‰§è¡Œçš„é€šè¿‡ç‡è¶‹åŠ¿ |
| **æ—¥å¿—é™„ä»¶** | è¯·æ±‚æ—¥å¿—ã€å“åº”æ—¥å¿—å¯ç›´æ¥æŸ¥çœ‹ |

#### ç¯å¢ƒé…ç½®

```xml
<?xml version="1.0" encoding="UTF-8"?>
<qa:environment xmlns:qa="urn:qatools:allure:environment">
    <n>æµ‹è¯•ç¯å¢ƒ</n>
    <value>http://127.0.0.1:8787</value>
    
    <n>æµ‹è¯•äººå‘˜</n>
    <value>Your Name</value>
    
    <n>Pythonç‰ˆæœ¬</n>
    <value>3.8+</value>
    
    <n>é¡¹ç›®åç§°</n>
    <value>ç”µå•†å¹³å°æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•</value>
</qa:environment>
```

---

## âœ¨ é¡¹ç›®äº®ç‚¹æ€»ç»“

### 1. POMè®¾è®¡æ¨¡å¼

**åˆ†å±‚æ¶æ„:**
- **ç”¨ä¾‹å±‚** (test_*.py): å®šä¹‰æµ‹è¯•åœºæ™¯,ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- **é©±åŠ¨å±‚** (apiutil.py): å°è£…è¯·æ±‚å¤„ç†ã€å‚æ•°æ›¿æ¢ã€æ–­è¨€é€»è¾‘
- **æ•°æ®å±‚** (*.yaml): å­˜å‚¨æµ‹è¯•æ•°æ®,å®ç°ç”¨ä¾‹ä¸æ•°æ®åˆ†ç¦»

**ä¼˜åŠ¿:**
- ä»£ç å¤ç”¨æ€§é«˜,ç»´æŠ¤æˆæœ¬ä½
- æ–°å¢ç”¨ä¾‹åªéœ€ç¼–å†™YAMLé…ç½®,æ— éœ€ä¿®æ”¹ä»£ç 
- é©±åŠ¨å±‚å˜æ›´ä¸å½±å“ç”¨ä¾‹å±‚

### 2. æ•°æ®é©±åŠ¨æµ‹è¯•

**å®ç°æ–¹å¼:**
- ä½¿ç”¨ YAML å­˜å‚¨æ¥å£é…ç½®å’Œæµ‹è¯•æ•°æ®
- ä½¿ç”¨ `@pytest.mark.parametrize` è¯»å–YAMLæ•°æ®
- å®ç°æµ‹è¯•ç”¨ä¾‹ä¸æµ‹è¯•æ•°æ®çš„å®Œå…¨åˆ†ç¦»

**ä¼˜åŠ¿:**
- éæŠ€æœ¯äººå‘˜ä¹Ÿèƒ½ç¼–å†™æµ‹è¯•ç”¨ä¾‹
- æ–°å¢ç”¨ä¾‹åªéœ€æ·»åŠ YAMLé…ç½®
- æµ‹è¯•æ•°æ®å¯è§†åŒ–ç®¡ç†

### 3. æ¥å£å‚æ•°å…³è”

**å®ç°æœºåˆ¶:**
- æ¥å£Aè¿”å›æ•°æ® â†’ è‡ªåŠ¨æå–å…³é”®å‚æ•° â†’ å­˜å‚¨åˆ°extract.yaml
- æ¥å£Bä½¿ç”¨ `${get_extract_data(key)}` è¯»å–å‚æ•°
- æ”¯æŒJSONPathã€æ­£åˆ™è¡¨è¾¾å¼ä¸¤ç§æå–æ–¹å¼

**ä¼˜åŠ¿:**
- æ— éœ€æ‰‹åŠ¨ä¼ é€’å‚æ•°,è‡ªåŠ¨å…³è”
- æ”¯æŒå¤æ‚ä¸šåŠ¡æµç¨‹æµ‹è¯•
- å‚æ•°å¯è¿½æº¯,ä¾¿äºè°ƒè¯•

### 4. å¤šç»´åº¦æ–­è¨€

**æ–­è¨€ç±»å‹:**
- **å“åº”æ–­è¨€**: éªŒè¯è¿”å›æ•°æ®çš„æ­£ç¡®æ€§
- **çŠ¶æ€ç æ–­è¨€**: éªŒè¯HTTPçŠ¶æ€ç 
- **æ•°æ®åº“æ–­è¨€**: éªŒè¯æ•°æ®æŒä¹…åŒ–

**ä¼˜åŠ¿:**
- å¤šç»´åº¦ä¿è¯æ¥å£è´¨é‡
- å‘ç°æ½œåœ¨çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜
- æå‡æµ‹è¯•å¯é æ€§

### 5. å…¨æµç¨‹ä¸šåŠ¡æµ‹è¯•

**ä¸šåŠ¡åœºæ™¯:**
- ç”¨æˆ·æ³¨å†Œ â†’ ç™»å½• â†’ è·å–token â†’ æ–°å¢/ä¿®æ”¹/åˆ é™¤ç”¨æˆ·
- è·å–å•†å“åˆ—è¡¨ â†’ æäº¤è®¢å• â†’ è®¢å•æ”¯ä»˜

**ä¼˜åŠ¿:**
- éªŒè¯å®Œæ•´ä¸šåŠ¡é“¾è·¯
- å‘ç°æ¥å£é—´çš„é›†æˆé—®é¢˜
- æ›´è´´è¿‘çœŸå®ç”¨æˆ·åœºæ™¯

---

## ğŸ“ æŠ€æœ¯æ”¶è·

- âœ… æŒæ¡ Pytest æµ‹è¯•æ¡†æ¶çš„é«˜çº§ç”¨æ³•(å‚æ•°åŒ–ã€fixtureã€æ ‡è®°)
- âœ… å­¦ä¼šè®¾è®¡POMæ¨¡å¼çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- âœ… ç†è§£æ¥å£æµ‹è¯•çš„æ ¸å¿ƒè¦ç´ (è¯·æ±‚ã€æ–­è¨€ã€å‚æ•°å…³è”)
- âœ… æŒæ¡YAMLæ•°æ®é©±åŠ¨æµ‹è¯•æ–¹æ³•
- âœ… ç†Ÿæ‚‰Allureæµ‹è¯•æŠ¥å‘Šçš„é…ç½®ä¸ä½¿ç”¨
- âœ… äº†è§£SQLAlchemyè¿›è¡Œæ•°æ®åº“æ–­è¨€
- âœ… å®è·µCI/CDé›†æˆæµç¨‹(Jenkins/Linux)

---

## ğŸ“š ç›¸å…³èµ„æº

- [Pytest å®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [Allure å®˜æ–¹æ–‡æ¡£](https://docs.qameta.io/allure/)
- [Requests æ–‡æ¡£](https://requests.readthedocs.io/)
- [JSONPath åœ¨çº¿å·¥å…·](http://www.atoolbox.net/Tool.php?Id=792)

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿Staræ”¯æŒ â­**

</div>